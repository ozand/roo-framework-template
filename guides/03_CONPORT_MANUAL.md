# Инструкция по работе с Context Portal (ConPort) для AI-ассистированной разработки

Context Portal (ConPort) — это ваш "банк памяти" проекта. Он помогает AI-ассистенту лучше понимать ваш проект, храня его ключевые детали: принятые решения, текущие задачи, архитектурные паттерны и другую важную информацию. Это MCP-сервер, который создает для каждого проекта свою базу знаний, позволяя AI-агенту предоставлять более точные и релевантные ответы [cite: roo_flow_conport.md].

---

### 1. Установка и настройка ConPort (Единоразово)

Прежде чем начать, убедитесь, что ConPort правильно установлен и настроен.

1.  **Установите ConPort:**

    -   Склонируйте репозиторий: `git clone https://github.com/GreatScottyMac/context-portal.git` [cite: roo_flow_conport.md].
    -   Создайте и активируйте виртуальное окружение Python (рекомендуется `uv`).
    -   Установите зависимости: `uv pip install -r requirements.txt` [cite: roo_flow_conport.md].

2.  **Настройте ваш AI-клиент (например, Roo Code в VS Code):**

    -   Откройте файл конфигурации MCP-серверов (например, `mcp_settings.json` для Roo Code) [cite: roo_code_mcp_en.md].
    -   Добавьте конфигурацию для `conport`, используя **абсолютные пути** к Python-интерпретатору в виртуальном окружении и к `main.py` скрипту ConPort. Это критически важный шаг для стабильной работы.

    **Пример конфигурации для Windows (замените пути на ваши):**

    ```json
    {
      "mcpServers": {
        "conport": {
          "command": "C:\\Users\\YourUser\\Projects\\context-portal\\.venv\\Scripts\\python.exe",
          "args": [
            "C:\\Users\\YourUser\\Projects\\context-portal\\src\\context_portal_mcp\\main.py",
            "--mode",
            "stdio",
            "--workspace_id",
            "${workspaceFolder}"
          ],
          "disabled": false
        }
      }
    }
    ```

    -   Переменная `${workspaceFolder}` автоматически подставляется IDE и указывает на корень вашего текущего проекта [cite: roo_flow_conport.md].

3.  **Интеграция с RooFlow (если используется):**
    -   В вашем проекте должен быть выполнен скрипт `install_rooflow_conport.cmd`. Этот скрипт адаптирует системные промпты RooFlow для работы со стратегией ConPort [cite: roo_task_may-27-2025_4-31-30-pm.md].

---

### 2. Гарантированная инициализация ConPort в начале сессии (Решение вашей проблемы)

Судя по логам, основная сложность возникает именно на этом этапе. AI-клиент не всегда автоматически "подхватывает" активный ConPort-сервер. Чтобы решить эту проблему, следуйте этому алгоритму:

1.  **Начните сессию с явной команды:**

    -   В самом начале диалога с AI-агентом дайте ему прямую команду на инициализацию. Документация ConPort рекомендует использовать английскую фразу, так как она, скорее всего, заложена в системный промпт:
        > `Initialize according to custom instructions.`
    -   Это должно заставить AI выполнить последовательность действий для подключения к ConPort.

2.  **Следите за статусом:**

    -   AI-агент должен ответить сообщением `[CONPORT_ACTIVE]`. Это индикатор того, что он успешно подключился к ConPort и готов к работе [cite: roo_task_may-27-2025_4-31-30-pm.md].
    -   Если вы видите `[CONPORT_INACTIVE]`, значит, подключение не удалось. Попробуйте повторить команду на инициализацию или попросите агента проверить статус ConPort.

3.  **Первичная загрузка контекста (для новых проектов):**
    -   **Создайте `projectBrief.md`:** В корне вашего проекта создайте файл `projectBrief.md` и опишите в нем высокоуровневые цели, архитектуру и ключевые особенности проекта [cite: roo_flow_conport.md].
    -   **Подтвердите импорт:** После команды на инициализацию AI-агент обнаружит этот файл и спросит, хотите ли вы импортировать его содержимое в "Product Context" ConPort. **Согласитесь.**
    -   В логах видно, что агент успешно читает этот файл и использует инструмент `update_product_context` для наполнения базы знаний [cite: roo_task_may-27-2025_4-31-30-pm.md].

---

### 3. Взаимодействие с ConPort через AI-агента

После успешной инициализации (`[CONPORT_ACTIVE]`) вы можете эффективно использовать ConPort для управления информацией о проекте.

-   **Логирование информации:** Просите AI заносить важную информацию в "банк памяти".

    -   `"Запиши принятое решение: [ваше решение]"` (использует `log_decision`) [cite: roo_task_may-27-2025_4-31-30-pm.md].
    -   `"Обнови статус задачи '[название задачи]' на 'COMPLETED'"` (использует `log_progress`) [cite: roo_task_may-27-2025_4-31-30-pm.md].
    -   `"Задокументируй этот архитектурный паттерн"` (использует `log_system_pattern`) [cite: roo_task_may-27-2025_6-59-59-pm.md].
    -   `"Сохрани эти учетные данные в 'ApiKeys'"` (использует `log_custom_data`).

-   **Обновление контекста:**

    -   `"Обнови активный контекст: сейчас я работаю над [описание задачи]"` (использует `update_active_context`) [cite: roo_task_may-27-2025_6-59-59-pm.md].

-   **Получение информации:**

    -   `"Напомни, какое решение мы приняли по поводу [тема]?"` (использует `get_decisions` или `search_decisions_fts`).
    -   `"Какой сейчас статус у задачи по рефакторингу?"` (использует `get_progress`).

-   **Связывание элементов:**
    -   `"Свяжи решение [ID решения] с задачей [ID задачи] как 'реализует'"` (использует `link_conport_items`) [cite: roo_flow_conport.md].

---

### 4. Устранение неполадок

-   **ConPort не активируется:**
    -   **Проверьте конфигурацию:** Убедитесь, что пути в `mcp_settings.json` абсолютные и верные.
    -   **Проверьте лог ConPort:** В вашем AI-клиенте (IDE) найдите логи MCP-сервера "conport". Там могут быть сообщения об ошибках.
    -   **Перезапустите AI-клиента:** Иногда полный перезапуск IDE помогает переинициализировать MCP-серверы.
